<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MisSup - Panel</title>
    <style>
        /* ======= ESTILOS GENERALES (MANTENIDOS) ======= */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f2f4f8; min-height: 100vh; }

        /* ======= PANTALLA LOGIN/REGISTRO (MANTENIDOS) ======= */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #002147, #0047ab);
        }

        .login-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .login-header h1 {
            color: #002147;
            margin-bottom: 8px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            color: #002147;
            border-bottom: 2px solid #002147;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #002147;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn-login {
            width: 100%;
            background: #002147;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .role-info {
            background: #e6f2ff;
            padding: 12px;
            border-radius: 5px;
            margin-top: 20px;
            font-size: 12px;
            color: #002147;
        }
        
        .role-info ul {
            margin-left: 15px;
            margin-top: 5px;
        }

        /* ======= SIDEBAR (MANTENIDOS) ======= */
        .sidebar {
            position: fixed;
            left: 0; top: 0;
            width: 240px;
            height: 100vh;
            background-color: #002147;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 100;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .sidebar-menu {
            list-style: none;
            padding: 10px 0;
        }

        .sidebar-menu li a {
            display: block;
            padding: 12px 20px;
            text-decoration: none;
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
        }

        .sidebar-menu li a:hover,
        .sidebar-menu li a.active {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .btn-logout {
            background: #ff6666;
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* ======= CONTENIDO (MANTENIDOS) ======= */
        .main-app {
            display: none;
        }

        .main-content {
            margin-left: 240px;
            padding: 25px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .user-role {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 13px;
        }

        .user-role.admin { background: #ffb366; color: white; }
        .user-role.user { background: #99ccff; color: #002147; }

        .btn-primary {
            background: #002147;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        /* ======= PRODUCTOS (MANTENIDOS Y AJUSTADOS) ======= */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .product-image { 
            height: 150px; 
            background: #e6e9ef; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
            font-size: 40px;
            color: #002147;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-info { padding: 15px; }
        .product-name { font-weight: bold; color: #002147; }
        .product-price { margin-top: 8px; font-weight: bold; color: #0047ab; }

        .btn-cart, .btn-edit, .btn-delete {
            margin: 5px 2px;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            cursor: pointer;
            font-size: 12px;
        }
        
        /* Estilo para el stock */
        .product-stock-info {
            font-size: 14px;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dotted #ccc;
        }
        .low-stock { color: #ffb366; font-weight: bold; }
        .out-of-stock { color: #ff6666; font-weight: bold; }
        .in-stock { color: #28a745; }


        /* ======= OVERLAY FORMULARIO (MANTENIDOS) ======= */
        .overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .form-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-container h3 {
            color: #002147;
            margin-bottom: 20px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h1>MisSup</h1>
                <p>Inicia sesión o regístrate para acceder</p>
            </div>

            <div class="tabs">
                <div class="tab active" id="loginTab">Iniciar Sesión</div>
                <div class="tab" id="registerTab">Registrarse</div>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Correo electrónico</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn-login">Iniciar Sesión</button>
            </form>

            <form id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="regName">Nombre completo</label>
                    <input type="text" id="regName" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Correo electrónico</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Contraseña</label>
                    <input type="password" id="regPassword" required>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Confirmar contraseña</label>
                    <input type="password" id="regConfirmPassword" required>
                </div>
                <button type="submit" class="btn-login">Registrarse</button>
            </form>

            <div class="role-info">
                <strong>Credenciales de Prueba:</strong>
                <ul>
                    <li>*Administrador:* admin@tecmilenio.mx / 123</li>
                    <li>*Usuario Normal:* user@mail.com / 123</li>
                    <li>Cualquier registro con correo @tecmilenio.mx obtiene rol de *Administrador*.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="main-app" id="mainApp">
        <aside class="sidebar">
            <div>
                <div class="sidebar-header">
                    <h2>MisSup</h2>
                    <p id="sidebarUser">Usuario</p>
                </div>

                <ul class="sidebar-menu">
                    <li><a href="#" class="active" id="menuCatalogo">Catálogo</a></li>
                    <li><a href="#" id="menuCarrito">🛒 Carrito</a></li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">Cerrar sesión</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1 id="pageTitle">Catálogo de Productos</h1>
                <div>
                    <span id="userName">Usuario</span> |
                    <span class="user-role user" id="userRole">Usuario</span>
                </div>
            </div>

            <div id="adminActions" style="margin-top:20px; display:none;">
                <button class="btn-primary" id="btnAgregar">➕ Agregar producto</button>
            </div>

            <div id="contentArea">
                <div class="products-grid" id="productosGrid"></div>
            </div>
        </main>
    </div>

    <div class="overlay" id="overlay">
        <div class="form-container">
            <h3 id="formTitle">Agregar Producto</h3>
            <input type="hidden" id="productId">
            <div class="form-group">
                <label for="productName">Nombre del producto</label>
                <input type="text" id="productName" required>
            </div>
            <div class="form-group">
                <label for="productCategory">Categoría</label>
                <input type="text" id="productCategory" required>
            </div>
            <div class="form-group">
                <label for="productPrice">Precio</label>
                <input type="number" id="productPrice" min="0" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="productStock">Cantidad en stock</label>
                <input type="number" id="productStock" min="0" required>
            </div>
            <div class="form-group">
                <label for="productImage">URL de imagen (opcional)</label>
                <input type="text" id="productImage" placeholder="https://ejemplo.com/imagen.jpg">
            </div>
            <div class="form-actions">
                <button class="btn-primary" id="btnGuardar">Guardar</button>
                <button class="btn-cancel" id="btnCancelar">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ========= DATOS SIMULADOS =========
        let usuario = null;
        // **NUEVO: Se agrega la propiedad 'cantidad' (stock) a los productos**
        let productos = [
            {id: 1, nombre: "Laptop HP", categoria: "Tecnología", precio: 18000, cantidad: 5, imagen: "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"},
            {id: 2, nombre: "Audífonos JBL", categoria: "Audio", precio: 1200, cantidad: 12, imagen: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"},
            {id: 3, nombre: "Cereal Kellogg's", categoria: "Comida", precio: 85, cantidad: 0, imagen: "https://images.unsplash.com/photo-1627483262769-04d0a1401487?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"},
            {id: 4, nombre: "Camisa Polo", categoria: "Ropa", precio: 350, cantidad: 20, imagen: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80"}
        ];
        
        // BASE DE DATOS DE USUARIOS SIMULADA
        let usuariosDB = [
            { nombre: "admin", email: "admin@tecmilenio.mx", password: "123", esAdmin: true },
            { nombre: "usuario", email: "user@mail.com", password: "123", esAdmin: false }
        ];

        let editandoProducto = false;
        
        // El carrito y otras funcionalidades se quitan para simplificar
        let carrito = []; 

        // ========= ELEMENTOS DOM =========
        const loginScreen = document.getElementById("loginScreen");
        const mainApp = document.getElementById("mainApp");
        const loginForm = document.getElementById("loginForm");
        const registerForm = document.getElementById("registerForm");
        const loginTab = document.getElementById("loginTab");
        const registerTab = document.getElementById("registerTab");
        const userName = document.getElementById("userName");
        const userRole = document.getElementById("userRole");
        const sidebarUser = document.getElementById("sidebarUser");
        const productosGrid = document.getElementById("productosGrid");
        const adminActions = document.getElementById("adminActions");
        const btnAgregar = document.getElementById("btnAgregar");
        const overlay = document.getElementById("overlay");
        const formTitle = document.getElementById("formTitle");
        const productId = document.getElementById("productId");
        const productName = document.getElementById("productName");
        const productCategory = document.getElementById("productCategory");
        const productPrice = document.getElementById("productPrice");
        // **NUEVO: Elemento para el stock**
        const productStock = document.getElementById("productStock"); 
        const productImage = document.getElementById("productImage");
        const btnGuardar = document.getElementById("btnGuardar");
        const btnCancelar = document.getElementById("btnCancelar");
        const pageTitle = document.getElementById("pageTitle");
        const contentArea = document.getElementById("contentArea");
        const logoutBtn = document.getElementById("logoutBtn");

        // ========= AUTENTICACIÓN Y ROLES (Funcionalidad simplificada) =========

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        });

        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (email && password) {
                iniciarSesion(email, password);
            } else {
                alert('Por favor, completa todos los campos');
            }
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }
            if (name && email && password) {
                registrarUsuario(name, email, password);
            } else {
                alert('Por favor, completa todos los campos');
            }
        });

        function iniciarSesion(email, password) {
            const userFound = usuariosDB.find(u => u.email === email);
            if (userFound && userFound.password === password) {
                usuario = userFound;
                actualizarInterfazUsuario();
                loginScreen.style.display = 'none';
                mainApp.style.display = 'block';
            } else {
                alert('Credenciales incorrectas');
            }
        }

        function registrarUsuario(nombre, email, password) {
            const userExists = usuariosDB.find(u => u.email === email);
            if (userExists) {
                alert('Este correo electrónico ya está registrado.');
                return;
            }
            const esAdmin = email.endsWith('@tecmilenio.mx');
            const nuevoUsuario = { nombre, email, password, esAdmin };
            usuariosDB.push(nuevoUsuario);
            usuario = nuevoUsuario;
            alert(`Registro exitoso. Bienvenido, ${nombre}.`);
            actualizarInterfazUsuario();
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
        }

        logoutBtn.addEventListener('click', () => {
            usuario = null;
            loginScreen.style.display = 'flex';
            mainApp.style.display = 'none';
            loginForm.reset();
            registerForm.reset();
            loginTab.click();
        });


        function actualizarInterfazUsuario() {
            userName.textContent = usuario.nombre;
            sidebarUser.textContent = usuario.nombre;
            userRole.textContent = usuario.esAdmin ? "Administrador" : "Usuario";
            userRole.className = usuario.esAdmin ? "user-role admin" : "user-role user";
            
            if (usuario.esAdmin) {
                adminActions.style.display = "block";
            } else {
                adminActions.style.display = "none";
            }
            
            mostrarProductos();
        }

        // ========= FUNCIONES DE PRODUCTOS (Modificada para mostrar stock) =========
        function mostrarProductos() {
            productosGrid.innerHTML = '';

            productos.forEach(p => {
                const card = document.createElement("div");
                card.className = "product-card";
                
                let imagenHTML = p.imagen ? `<img src="${p.imagen}" alt="${p.nombre}" onerror="this.onerror=null; this.parentElement.innerHTML='🛍';">` : '🛍';

                let stockClass = 'in-stock';
                let stockText = `Stock: ${p.cantidad}`;

                if (p.cantidad === 0) {
                    stockClass = 'out-of-stock';
                    stockText = 'AGOTADO';
                } else if (p.cantidad < 5) {
                    stockClass = 'low-stock';
                    stockText = `Bajo Stock: ${p.cantidad}`;
                }


                card.innerHTML = `
                    <div class="product-image">${imagenHTML}</div>
                    <div class="product-info">
                        <div class="product-name">${p.nombre}</div>
                        <div class="product-category">${p.categoria}</div>
                        <div class="product-price">$${p.precio.toFixed(2)}</div>
                        <div class="product-stock-info ${stockClass}">${stockText}</div>
                        <div>
                            ${usuario.esAdmin
                                ? `<button class="btn-edit" onclick="editar(${p.id})">Editar</button>
                                   <button class="btn-delete" onclick="borrar(${p.id})">Borrar</button>`
                                : `<button class="btn-cart" onclick="alert('Funcionalidad de carrito no implementada en esta versión.')">Agregar al carrito</button>`
                            }
                        </div>
                    </div>
                `;
                productosGrid.appendChild(card);
            });
        }
        
        // **Función de edición modificada para cargar el stock**
        window.editar = function(id) {
            const p = productos.find(x => x.id === id);
            if (!usuario.esAdmin) return; 

            editandoProducto = true;
            formTitle.textContent = "Editar Producto";
            productId.value = p.id;
            productName.value = p.nombre;
            productCategory.value = p.categoria;
            productPrice.value = p.precio;
            // **IMPORTANTE: Cargar el stock actual**
            productStock.value = p.cantidad; 
            productImage.value = p.imagen || "";
            overlay.style.display = "flex";
        }

        window.borrar = function(id) {
            if (!usuario.esAdmin) return;
            if (confirm("¿Estás seguro de que quieres eliminar este producto?")) {
                productos = productos.filter(x => x.id !== id);
                mostrarProductos();
            }
        }

        // ========= GESTIÓN DE PRODUCTOS (ADMIN) (Modificada para guardar stock) =========
        btnAgregar.addEventListener('click', () => {
            editandoProducto = false;
            formTitle.textContent = "Agregar Producto";
            productId.value = "";
            productName.value = "";
            productCategory.value = "";
            productPrice.value = "";
            // **Establecer stock inicial al agregar**
            productStock.value = "0"; 
            productImage.value = "";
            overlay.style.display = "flex";
        });

        btnGuardar.addEventListener('click', () => {
            const id = productId.value;
            const nombre = productName.value;
            const categoria = productCategory.value;
            const precio = parseFloat(productPrice.value);
            // **IMPORTANTE: Capturar el valor del stock**
            const cantidad = parseInt(productStock.value); 
            const imagen = productImage.value;

            if (!nombre || !categoria || !precio || isNaN(precio) || precio < 0 || isNaN(cantidad) || cantidad < 0) {
                alert("Por favor, completa todos los campos obligatorios con valores válidos (Stock y Precio deben ser números positivos).");
                return;
            }
            
            if (editandoProducto) {
                const index = productos.findIndex(p => p.id == id);
                if (index !== -1) {
                    productos[index] = {
                        id: parseInt(id),
                        nombre,
                        categoria,
                        precio: parseFloat(precio.toFixed(2)),
                        // **Guardar el nuevo stock**
                        cantidad: cantidad, 
                        imagen
                    };
                }
            } else {
                const nuevoId = productos.length > 0 ? Math.max(...productos.map(p => p.id)) + 1 : 1;
                productos.push({
                    id: nuevoId,
                    nombre,
                    categoria,
                    precio: parseFloat(precio.toFixed(2)),
                    // **Guardar el stock al crear**
                    cantidad: cantidad, 
                    imagen
                });
            }

            mostrarProductos();
            overlay.style.display = "none";
        });

        btnCancelar.addEventListener('click', () => {
            overlay.style.display = "none";
        });
        
        // Funcionalidad de navegación eliminada para volver a lo esencial (Catálogo)
        document.getElementById('menuCatalogo').addEventListener('click', (e) => {
            e.preventDefault();
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            e.target.classList.add('active');
            mostrarProductos();
        });
        
        document.getElementById('menuCarrito').addEventListener('click', (e) => {
            e.preventDefault();
            alert("El carrito y el checkout fueron removidos. Vuelve al Catálogo.");
        });

        // Simular inicio de sesión al cargar para prueba rápida
        iniciarSesion("admin@tecmilenio.mx", "123"); 
    </script>
</body>
</html>
